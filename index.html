<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>å¾·å·æ’²å…‹ â€“ é›™äººæ’²å…‹éŠæˆ²</title>
  <style>
    /* ============================ */
    /* åŸºæœ¬è¨­å®š                     */
    /* ============================ */
    body {
      margin: 0;
      padding: 0;
      background: #222;
      font-family: 'Microsoft JhengHei', 'PingFang TC', 'Heiti TC', sans-serif;
      color: #eee;
      user-select: none;
      overflow-y: auto;
    }
    /* ä¸»è¦å®¹å™¨ */
    #gameContainer {
      width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: #333;
      border-radius: 10px;
      box-shadow: 0 0 20px #000;
    }
    h1 {
      text-align: center;
      color: #0f0;
      text-shadow: 0 0 10px #0f0;
    }
    /* ============================ */
    /* HUD å’Œè¨Šæ¯                   */
    /* ============================ */
    #hud {
      font-size: 20px;
      margin-bottom: 10px;
      text-align: center;
      color: #0f0;
      text-shadow: 0 0 8px #0f0;
    }
    #messages {
      text-align: center;
      margin: 10px 0;
      font-size: 18px;
      color: #0f0;
      text-shadow: 0 0 6px #0f0;
    }
    /* ============================ */
    /* å€åŸŸä½ˆå±€                     */
    /* ============================ */
    .section {
      margin-bottom: 20px;
      padding: 10px;
      background: #444;
      border-radius: 5px;
    }
    .section-title {
      font-weight: bold;
      margin-bottom: 5px;
      text-align: center;
      text-shadow: 0 0 6px #0f0;
    }
    .cardsContainer {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    /* ============================ */
    /* å¡ç‰Œæ¨£å¼                     */
    /* ============================ */
    .card {
      width: 80px;
      height: 120px;
      background: #fff;
      border: 2px solid #999;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 6px;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(0,0,0,0.5);
      transition: transform 0.1s ease;
    }
    .card:hover {
      transform: scale(1.05);
    }
    .card .value {
      font-size: 24px;
      font-weight: bold;
      color: #222;
    }
    .card .suit {
      font-size: 32px;
    }
    .card-back {
      background: linear-gradient(45deg, #999, #666);
      color: transparent;
    }
    /* ============================ */
    /* ä¸‹æ³¨æ§åˆ¶å’Œé€²è¡Œæ§åˆ¶           */
    /* ============================ */
    #betControls, #advanceControls {
      text-align: center;
      margin: 20px 0;
    }
    #betControls button, #advanceControls button {
      background: #0f0;
      color: #222;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      font-size: 18px;
      margin: 5px;
      cursor: pointer;
      box-shadow: 0 0 6px #0f0;
      text-shadow: 0 0 3px #fff;
    }
    /* é¡å¤–æŒ‰éˆ•ï¼ˆä¾‹å¦‚èªªæ˜ï¼‰ */
    #extraControls {
      text-align: center;
      margin-top: 10px;
    }
    #extraControls button {
      background: #0f0;
      color: #222;
      border: none;
      border-radius: 5px;
      padding: 8px 16px;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 0 6px #0f0;
      text-shadow: 0 0 3px #fff;
    }
    /* ============================ */
    /* è¦†è“‹å±¤ï¼šèªªæ˜ã€éŠæˆ²çµæŸã€é–‹å§‹ */
    /* ============================ */
    .overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 999;
      text-align: center;
      color: #0f0;
      text-shadow: 0 0 8px #0f0;
    }
    .overlay.hidden { display: none; }
    .overlay p {
      font-size: 20px;
      max-width: 600px;
      margin: 10px;
      line-height: 1.4;
    }
    .overlay button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 20px;
      background: #0f0;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 0 6px #0f0;
    }
  </style>
</head>
<body>
  <!-- éŠæˆ²å€åŸŸ -->
  <div id="gameContainer">
    <h1>å¾·å·æ’²å…‹ â€“ é›™äººå°æˆ°</h1>
    <div id="hud">
      ç‹€æ…‹ï¼šç¿»ç‰Œå‰<br>
      ç±Œç¢¼ï¼šæ‚¨ 1000 å…ƒ - é›»è…¦ 1000 å…ƒ<br>
      å½©æ± ï¼š30 å…ƒ
    </div>
    <div id="messages"></div>
    
    <div class="section">
      <div class="section-title">å…¬å…±ç‰Œ</div>
      <div id="communityCards" class="cardsContainer"></div>
    </div>
    <div class="section">
      <div class="section-title">æ‚¨çš„æ‰‹ç‰Œ</div>
      <div id="playerCards" class="cardsContainer"></div>
    </div>
    <div class="section">
      <div class="section-title">é›»è…¦æ‰‹ç‰Œ</div>
      <div id="botCards" class="cardsContainer"></div>
    </div>
    
    <!-- ä¸‹æ³¨æ§åˆ¶ï¼ˆåƒ…ç¿»ç‰Œå‰ï¼‰ -->
    <div id="betControls" class="hidden">
      <button id="callBtn">è·Ÿæ³¨/éç‰Œ</button>
      <button id="betBtn">åŠ æ³¨ (+20)</button>
      <button id="foldBtn">æ£„ç‰Œ</button>
      <br>
      <span id="betInstructions">è«‹é¸æ“‡æ‚¨çš„ç¿»ç‰Œå‰å‹•ä½œ</span>
    </div>
    
    <!-- æ¨é€²éšæ®µæ§åˆ¶ -->
    <div id="advanceControls" class="hidden"></div>
    
    <!-- é¡å¤–æ§åˆ¶ -->
    <div id="extraControls">
      <button id="helpBtn">éŠæˆ²èªªæ˜</button>
    </div>
  </div>
  
  <!-- èªªæ˜è¦†è“‹å±¤ -->
  <div id="helpOverlay" class="overlay hidden">
    <p>
      <strong>å¾·å·æ’²å…‹è¦å‰‡ï¼ˆç°¡åŒ–ç‰ˆï¼‰</strong><br>
      â€¢ æ¯ä½ç©å®¶ç²å¾— 2 å¼µåº•ç‰Œï¼ˆæ‰‹ç‰Œï¼‰ã€‚<br>
      â€¢ ç™¼å‡º 5 å¼µå…¬å…±ç‰Œï¼šç¿»ç‰Œï¼ˆ3 å¼µï¼‰ã€è½‰ç‰Œï¼ˆ1 å¼µï¼‰åŠæ²³ç‰Œï¼ˆ1 å¼µï¼‰ã€‚<br>
      â€¢ ç¿»ç‰Œå‰æ‚¨æ”¯ä»˜å°ç›²æ³¨ï¼ˆ10 ç±Œç¢¼ï¼‰ï¼Œé›»è…¦æ”¯ä»˜å¤§ç›²æ³¨ï¼ˆ20 ç±Œç¢¼ï¼‰â†’ åˆå§‹å½©æ± ï¼š30 å…ƒã€‚<br>
      â€¢ ç¿»ç‰Œå‰é¸æ“‡ï¼šã€Œè·Ÿæ³¨/éç‰Œã€è£œé½Šè‡³ 20ï¼ˆå†åŠ  10ï¼‰ï¼Œã€ŒåŠ æ³¨ã€é¡å¤–ä¸‹æ³¨ 20ï¼Œæˆ–ã€Œæ£„ç‰Œã€æ”¾æ£„æ­¤å±€ï¼ˆé›»è…¦ç²å‹ï¼‰ã€‚<br>
      â€¢ ç¿»ç‰Œå‰çµæŸå¾Œï¼ŒæŒ‰ã€Œæ¨é€²ã€ç¹¼çºŒï¼šç¬¬1æ¬¡é»æ“Šé¡¯ç¤ºç¿»ç‰Œï¼Œç¬¬2æ¬¡é¡¯ç¤ºè½‰ç‰Œï¼Œç¬¬3æ¬¡é¡¯ç¤ºæ²³ç‰Œï¼Œç¬¬4æ¬¡é€²è¡Œæ”¤ç‰Œã€‚<br>
      â€¢ æ”¤ç‰Œæ¯”è¼ƒæœ€ä½³ 5 å¼µç‰Œçµ„åˆï¼ˆå¾ 7 å¼µä¸­é¸æ“‡ï¼š2 å¼µæ‰‹ç‰Œ + 5 å¼µå…¬å…±ç‰Œï¼‰ï¼ŒæŒ‰æ¨™æº–æ’åºæ±ºå®šå‹è² ã€‚ç²å‹è€…å–å¾—å½©æ± ã€‚<br>
      â€¢ æ¯å±€æ›´æ–°ç±Œç¢¼ï¼›è‹¥ç‰Œå †ä¸è¶³ï¼Œé¡¯ç¤ºæœ€çµ‚ç¸½çµï¼ˆéŠæˆ²çµæŸï¼‰ã€‚
    </p>
    <button id="closeHelpBtn">é—œé–‰èªªæ˜</button>
  </div>
  
  <!-- éŠæˆ²çµæŸè¦†è“‹å±¤ -->
  <div id="gameOverOverlay" class="overlay hidden">
    <p id="gameOverMsg"></p>
    <button id="restartBtn">æ–°å±€é–‹å§‹</button>
  </div>
  
  <!-- é–‹å§‹è¦†è“‹å±¤ -->
  <div id="startOverlay" class="overlay">
    <p>
      <strong>å¾·å·æ’²å…‹ â€“ é›™äººå°æˆ°æ’²å…‹</strong><br>
      åˆå§‹ç±Œç¢¼ï¼šæ¯äºº 1000 å…ƒ
    </p>
    <button id="startBtn">é–‹å§‹éŠæˆ²</button>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // --------------------------
      // å¡ç‰Œæ¸²æŸ“å‡½æ•¸
      // --------------------------
      function renderCard(card) {
        let div = document.createElement("div");
        div.className = "card";
        let parts = card.display.split(" ");
        div.innerHTML = `<div class="value">${parts[0]}</div><div class="suit">${parts[1]}</div>`;
        return div;
      }
      function renderCardBack() {
        let div = document.createElement("div");
        div.className = "card card-back";
        div.textContent = "ğŸ‚ ";
        return div;
      }
      
      // --------------------------
      // éŠæˆ²å…¨åŸŸè®Šæ•¸
      // --------------------------
      let _deck, _playerHole = [], _botHole = [], _community = [];
      let _playerChips = 1000, _botChips = 1000, _pot = 30;
      let _stage = "preflop"; // å¯èƒ½éšæ®µï¼š"preflop", "flop", "turn", "river", "showdown"
      let _currentBet = 20;   // å¤§ç›²æ³¨
      let _betPlaced = false;
      let advanceCount = 0;
      
      const suits = ["â™ ", "â™¥", "â™¦", "â™£"];
      const ranks = ["2","3","4","5","6","7","8","9","10","J","Q","K","A"];
      const rankValues = {"2":2, "3":3, "4":4, "5":5, "6":6, "7":7, "8":8, "9":9, "10":10, "J":11, "Q":12, "K":13, "A":14};
      
      // --------------------------
      // DOM å…ƒç´ 
      // --------------------------
      const hudEl = document.getElementById("hud");
      const messagesEl = document.getElementById("messages");
      const communityCardsEl = document.getElementById("communityCards");
      const playerCardsEl = document.getElementById("playerCards");
      const botCardsEl = document.getElementById("botCards");
      
      const betControlsEl = document.getElementById("betControls");
      const advanceControlsEl = document.getElementById("advanceControls");
      const callBtn = document.getElementById("callBtn");
      const betBtn = document.getElementById("betBtn");
      const foldBtn = document.getElementById("foldBtn");
      
      const helpBtn = document.getElementById("helpBtn");
      const closeHelpBtn = document.getElementById("closeHelpBtn");
      const gameOverOverlay = document.getElementById("gameOverOverlay");
      const gameOverMsgEl = document.getElementById("gameOverMsg");
      const restartBtn = document.getElementById("restartBtn");
      const startOverlay = document.getElementById("startOverlay");
      const startBtn = document.getElementById("startBtn");
      
      // --------------------------
      // ç‰Œå †å‡½æ•¸
      // --------------------------
      function createDeck() {
        let d = [];
        for (let suit of suits) {
          for (let rank of ranks) {
            d.push({
              rank: rank,
              suit: suit,
              value: rankValues[rank],
              display: rank + " " + suit
            });
          }
        }
        return d;
      }
      
      function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
      }
      
      // --------------------------
      // ç”Ÿæˆçµ„åˆå‡½æ•¸ï¼ˆç”¨æ–¼è©•ä¼°æ‰‹ç‰Œï¼‰
      // --------------------------
      function getCombinations(array, k) {
        let results = [];
        function helper(start, combo) {
          if (combo.length === k) {
            results.push([...combo]);
            return;
          }
          for (let i = start; i < array.length; i++) {
            combo.push(array[i]);
            helper(i + 1, combo);
            combo.pop();
          }
        }
        helper(0, []);
        return results;
      }
      
      // --------------------------
      // æ‰‹ç‰Œè©•ä¼°ï¼ˆ5å¼µç‰Œï¼‰â€“ ç°¡åŒ–æ¼”ç®—æ³•
      // --------------------------
      function evaluateFiveCardHand(hand) {
        let cards = hand.slice().sort((a, b) => b.value - a.value);
        let values = cards.map(c => c.value);
        let suitsArr = cards.map(c => c.suit);
        let flush = suitsArr.every(s => s === suitsArr[0]);
      
        let isStraight = false;
        let straightHigh = 0;
        let uniqueValues = [...new Set(values)];
        uniqueValues.sort((a, b) => b - a);
        if (uniqueValues.length >= 5) {
          for (let i = 0; i <= uniqueValues.length - 5; i++) {
            let seq = uniqueValues.slice(i, i + 5);
            if (seq[0] - seq[4] === 4) {
              isStraight = true;
              straightHigh = seq[0];
              break;
            }
          }
          if (!isStraight && uniqueValues.includes(14)) {
            let mapped = uniqueValues.map(v => v === 14 ? 1 : v);
            mapped.sort((a, b) => b - a);
            for (let i = 0; i <= mapped.length - 5; i++) {
              let seq = mapped.slice(i, i + 5);
              if (seq[0] - seq[4] === 4) {
                isStraight = true;
                straightHigh = (seq[0] === 1 ? 5 : seq[0]);
                break;
              }
            }
          }
        }
      
        let counter = {};
        for (let c of cards) {
          counter[c.value] = (counter[c.value] || 0) + 1;
        }
        let groups = Object.entries(counter).map(e => [parseInt(e[0]), e[1]]);
        groups.sort((a, b) => {
          if (b[1] === a[1]) return b[0] - a[0];
          return b[1] - a[1];
        });
      
        let handRank = 1;
        let scoreArr = [];
        if (flush && isStraight) {
          handRank = 9;
          scoreArr = [straightHigh];
        } else if (groups[0][1] === 4) {
          handRank = 8;
          scoreArr = [groups[0][0]];
          let kicker = values.filter(v => v !== groups[0][0])[0];
          scoreArr.push(kicker);
        } else if (groups[0][1] === 3 && groups[1] && groups[1][1] >= 2) {
          handRank = 7;
          scoreArr = [groups[0][0], groups[1][0]];
        } else if (flush) {
          handRank = 6;
          scoreArr = values.slice(0, 5);
        } else if (isStraight) {
          handRank = 5;
          scoreArr = [straightHigh];
        } else if (groups[0][1] === 3) {
          handRank = 4;
          scoreArr = [groups[0][0]];
          let remain = values.filter(v => v !== groups[0][0]).slice(0, 2);
          scoreArr.push(...remain);
        } else if (groups[0][1] === 2 && groups[1] && groups[1][1] === 2) {
          handRank = 3;
          scoreArr = [groups[0][0], groups[1][0]];
          let kicker = values.filter(v => v !== groups[0][0] && v !== groups[1][0])[0];
          scoreArr.push(kicker);
        } else if (groups[0][1] === 2) {
          handRank = 2;
          scoreArr = [groups[0][0]];
          let remain = values.filter(v => v !== groups[0][0]).slice(0, 3);
          scoreArr.push(...remain);
        } else {
          handRank = 1;
          scoreArr = values.slice(0, 5);
        }
        return [handRank, ...scoreArr];
      }
      
      function compareHands(arr1, arr2) {
        for (let i = 0; i < Math.max(arr1.length, arr2.length); i++) {
          let a = arr1[i] || 0;
          let b = arr2[i] || 0;
          if (a > b) return 1;
          if (a < b) return -1;
        }
        return 0;
      }
      
      function evaluateHand(sevenCards) {
        let combos = getCombinations(sevenCards, 5);
        let best = null;
        for (let hand of combos) {
          let score = evaluateFiveCardHand(hand);
          if (best === null || compareHands(score, best) > 0) best = score;
        }
        return best;
      }
      
      // --------------------------
      // ä¸»è¦éŠæˆ²å‡½æ•¸
      // --------------------------
      function initPoker() {
        _deck = createDeck();
        shuffle(_deck);
        _playerHole = [_deck.pop(), _deck.pop()];
        _botHole = [_deck.pop(), _deck.pop()];
        _community = [];
        _stage = "preflop";
        _currentBet = 20;
        _betPlaced = false;
        _pot = 30; // æ‚¨ï¼š10ï¼Œé›»è…¦ï¼š20
        advanceCount = 0;
        updatePokerDisplay();
        updatePokerHUD();
        messagesEl.textContent = "ç¿»ç‰Œå‰ï¼šè«‹é¸æ“‡è·Ÿæ³¨/éç‰Œã€åŠ æ³¨ (+20) æˆ–æ£„ç‰Œ";
        betControlsEl.classList.remove("hidden");
        advanceControlsEl.innerHTML = "";
      }
      
      function updatePokerHUD() {
        hudEl.innerHTML = `éšæ®µï¼š${_stage}<br>
                           ç±Œç¢¼ï¼šæ‚¨ ${_playerChips} å…ƒ - é›»è…¦ ${_botChips} å…ƒ<br>
                           å½©æ± ï¼š${_pot} å…ƒ`;
      }
      
      function updatePokerDisplay(revealBot = false) {
        playerCardsEl.innerHTML = "";
        _playerHole.forEach(card => { playerCardsEl.appendChild(renderCard(card)); });
        botCardsEl.innerHTML = "";
        _botHole.forEach(card => {
          if (revealBot) botCardsEl.appendChild(renderCard(card));
          else botCardsEl.appendChild(renderCardBack());
        });
        communityCardsEl.innerHTML = "";
        _community.forEach(card => { communityCardsEl.appendChild(renderCard(card)); });
      }
      
      // ç¿»ç‰Œå‰ä¸‹æ³¨å‹•ä½œ
      function playerCall() {
        // æ‚¨å·²æ”¯ä»˜ 10ï¼›è¦é”åˆ° 20 éœ€å†åŠ  10
        let toCall = _currentBet - 10;
        if (_playerChips < toCall) {
          messagesEl.textContent = "ç±Œç¢¼ä¸è¶³ç„¡æ³•è·Ÿæ³¨ï¼";
          return;
        }
        _playerChips -= toCall;
        _pot += toCall;
        messagesEl.textContent = "æ‚¨å·²è·Ÿæ³¨ï¼ˆè·Ÿæ³¨/éç‰Œï¼‰ã€‚";
        _betPlaced = true;
        botCall();
        // ä¸‹æ³¨å¾Œï¼Œå‰µå»ºæ¨é€²æŒ‰éˆ•
        setTimeout(createAdvanceButton, 1000);
        updatePokerHUD();
      }
      
      function playerBet() {
        let betAmount = (_currentBet + 20) - 10;
        if (_playerChips < betAmount) {
          messagesEl.textContent = "ç±Œç¢¼ä¸è¶³ç„¡æ³•ä¸‹æ³¨ï¼";
          return;
        }
        _playerChips -= betAmount;
        _pot += betAmount;
        _currentBet += 20;
        messagesEl.textContent = "æ‚¨å·²åŠ æ³¨ (+20)ã€‚";
        _betPlaced = true;
        botCall();
        setTimeout(createAdvanceButton, 1000);
        updatePokerHUD();
      }
      
      function playerFold() {
        messagesEl.textContent = "æ‚¨å·²æ£„ç‰Œã€‚é›»è…¦è´å¾—å½©æ± ã€‚";
        _botChips += _pot;
        _pot = 0;
        endHandPoker();
      }
      
      function botCall() {
        let toCall = _currentBet - 20; // é›»è…¦å·²æ”¯ä»˜ 20
        if (_botChips >= toCall) {
          _botChips -= toCall;
          _pot += toCall;
          messagesEl.innerHTML += "<br>é›»è…¦å·²è·Ÿæ³¨ã€‚";
        }
        updatePokerHUD();
      }
      
      // --------------------------
      // æ‰‹å‹•æ¨é€²éšæ®µ
      // --------------------------
      // ç¿»ç‰Œå‰ä¸‹æ³¨å¾Œï¼Œç”¨æˆ¶é»æ“Šã€Œæ¨é€²ã€é€²å…¥å¾ŒçºŒéšæ®µï¼š
      // ç¬¬1æ¬¡ï¼šé¡¯ç¤ºç¿»ç‰Œï¼ˆ3å¼µï¼‰ï¼Œç¬¬2æ¬¡ï¼šè½‰ç‰Œï¼ˆ1å¼µï¼‰ï¼Œç¬¬3æ¬¡ï¼šæ²³ç‰Œï¼ˆ1å¼µï¼‰ï¼Œç¬¬4æ¬¡ï¼šæ”¤ç‰Œã€‚
      function advancePhase() {
        advanceCount++;
        if (advanceCount === 1) {
          // ç¿»ç‰Œï¼šç™¼å‡º 3 å¼µå…¬å…±ç‰Œ
          _community = _community.concat([_deck.pop(), _deck.pop(), _deck.pop()]);
          _stage = "flop";
          updatePokerDisplay();
          updatePokerHUD();
          messagesEl.textContent = "ç¿»ç‰Œå·²ç™¼å‡ºã€‚";
          createAdvanceButton();
        } else if (advanceCount === 2) {
          // è½‰ç‰Œï¼šä¸€å¼µç‰Œ
          _community.push(_deck.pop());
          _stage = "turn";
          updatePokerDisplay();
          updatePokerHUD();
          messagesEl.textContent = "è½‰ç‰Œå·²ç™¼å‡ºã€‚";
          createAdvanceButton();
        } else if (advanceCount === 3) {
          // æ²³ç‰Œï¼šä¸€å¼µç‰Œ
          _community.push(_deck.pop());
          _stage = "river";
          updatePokerDisplay();
          updatePokerHUD();
          messagesEl.textContent = "æ²³ç‰Œå·²ç™¼å‡ºã€‚";
          createAdvanceButton();
        } else if (advanceCount === 4) {
          // æ”¤ç‰Œ
          advanceControlsEl.innerHTML = "";
          showdown();
        }
      }
      
      function createAdvanceButton() {
        advanceControlsEl.innerHTML = "";
        let btn = document.createElement("button");
        if (_stage === "preflop") btn.textContent = "é¡¯ç¤ºç¿»ç‰Œ";
        else if (_stage === "flop") btn.textContent = "é¡¯ç¤ºè½‰ç‰Œ";
        else if (_stage === "turn") btn.textContent = "é¡¯ç¤ºæ²³ç‰Œ";
        else if (_stage === "river") btn.textContent = "æ”¤ç‰Œ";
        btn.addEventListener("click", advancePhase);
        advanceControlsEl.appendChild(btn);
        advanceControlsEl.classList.remove("hidden");
      }
      
      // æ”¤ç‰Œï¼šæ¯”è¼ƒæœ€ä½³æ‰‹ç‰Œï¼ˆè€ƒæ…® 7 å¼µç‰Œï¼š2 å¼µæ‰‹ç‰Œ + 5 å¼µå…¬å…±ç‰Œï¼‰
      function showdown() {
        if (_stage !== "river") return;
        _stage = "showdown";
        updatePokerDisplay(true);
        updatePokerHUD();
        hudEl.innerHTML += "<br>æ”¤ç‰Œï¼";
        let playerBest = evaluateHand(_playerHole.concat(_community));
        let botBest = evaluateHand(_botHole.concat(_community));
        let res = compareHands(playerBest, botBest);
        let resultText = "";
        if (res > 0) {
          resultText = "æ‚¨è´å¾—æ­¤å±€ï¼";
          _playerChips += _pot;
        } else if (res < 0) {
          resultText = "é›»è…¦è´å¾—æ­¤å±€ï¼";
          _botChips += _pot;
        } else {
          resultText = "å¹³æ‰‹ï¼å½©æ± å¹³åˆ†ã€‚";
          let half = _pot / 2;
          _playerChips += half;
          _botChips += half;
        }
        messagesEl.innerHTML = resultText + "<br>" +
          `æ‚¨çš„æ‰‹ç‰Œï¼ˆåˆ†æ•¸ï¼‰ï¼š[${playerBest.join(", ")}]<br>` +
          `é›»è…¦ï¼š[${botBest.join(", ")}]`;
        _pot = 0;
        updatePokerHUD();
        setTimeout(endHandPoker, 2000);
      }
      
      function endHandPoker() {
        if (_deck.length < 5) {
          let summary = `<strong>éŠæˆ²çµæŸ</strong><br>
                         æœ€çµ‚ç±Œç¢¼ï¼šæ‚¨ ${_playerChips} å…ƒ - é›»è…¦ ${_botChips} å…ƒ<br>`;
          if (_playerChips > _botChips) summary += "æ‚¨è´å¾—æ¯”è³½ï¼";
          else if (_botChips > _playerChips) summary += "é›»è…¦è´å¾—æ¯”è³½ï¼";
          else summary += "æ¯”è³½å¹³æ‰‹ï¼";
          gameOverMsgEl.innerHTML = summary;
          gameOverOverlay.classList.remove("hidden");
        } else {
          // æ–°å±€ï¼šé‡ç½®éšæ®µï¼Œç™¼æ–°æ‰‹ç‰Œï¼Œå½©æ± å’Œé‡ç½®æ¨é€²æŒ‰éˆ•
          _stage = "preflop";
          _currentBet = 20;
          _pot = 30;
          advanceCount = 0;
          _playerHole = [_deck.pop(), _deck.pop()];
          _botHole = [_deck.pop(), _deck.pop()];
          _community = [];
          updatePokerDisplay();
          updatePokerHUD();
          messagesEl.textContent = "ç¿»ç‰Œå‰ï¼šè«‹é¸æ“‡è·Ÿæ³¨/éç‰Œã€åŠ æ³¨ (+20) æˆ–æ£„ç‰Œ";
          betControlsEl.classList.remove("hidden");
          advanceControlsEl.innerHTML = "";
        }
      }
      
      // --------------------------
      // æŒ‰éˆ•äº‹ä»¶
      // --------------------------
      callBtn.addEventListener("click", function() { 
        playerCall(); 
        betControlsEl.classList.add("hidden"); 
      });
      betBtn.addEventListener("click", function() { 
        playerBet(); 
        betControlsEl.classList.add("hidden"); 
      });
      foldBtn.addEventListener("click", function() { 
        playerFold(); 
        betControlsEl.classList.add("hidden"); 
      });
      
      helpBtn.addEventListener("click", function() { 
        document.getElementById("helpOverlay").classList.remove("hidden"); 
      });
      closeHelpBtn.addEventListener("click", function() { 
        document.getElementById("helpOverlay").classList.add("hidden"); 
      });
      restartBtn.addEventListener("click", function() { 
        document.getElementById("gameOverOverlay").classList.add("hidden"); 
        initPoker(); 
      });
      startBtn.addEventListener("click", function() { 
        document.getElementById("startOverlay").classList.add("hidden"); 
        initPoker(); 
      });
      
      // --------------------------
      // æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–ï¼ˆé¡¯ç¤ºé–‹å§‹è¦†è“‹å±¤ï¼‰
      // --------------------------
      function initApp() {
        _playerChips = 1000;
        _botChips = 1000;
        document.getElementById("startOverlay").classList.remove("hidden");
        document.getElementById("helpOverlay").classList.add("hidden");
        document.getElementById("gameOverOverlay").classList.add("hidden");
        hudEl.innerHTML = "éšæ®µï¼šç­‰å¾…ä¸­";
        messagesEl.textContent = "";
      }
      
      initApp();
    });
  </script>
</body>
</html>
